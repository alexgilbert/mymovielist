(function(){var e;e=function(){function e(e,t,r,n,i,o,a){this.name=e,this.baseRequestForFilter=t,this.baseLinkForShowAllRecords=r,this.linkForExport=n,this.parameterNameForQueryLoading=i,this.parameterNameForFocus=o,this.environment=a,this.filterDeclarations=new Array,this.checkIfJsFrameworkIsLoaded()}return e.prototype.checkIfJsFrameworkIsLoaded=function(){return jQuery?void 0:alert("jQuery not loaded, WiceGrid cannot proceed!")},e.prototype.toString=function(){return"<WiceGridProcessor instance for grid '"+this.name+"'>"},e.prototype.process=function(e){return window.location=this.buildUrlWithParams(e)},e.prototype.setProcessTimer=function(e){var t;return this.timer&&(clearTimeout(this.timer),this.timer=null),t=this,this.timer=setTimeout(function(){return t.process(e)},1e3)},e.prototype.reloadPageForGivenGridState=function(e){var t;return t=this.gridStateToRequest(e),window.location=this.appendToUrl(this.baseLinkForShowAllRecords,t)},e.prototype.gridStateToRequest=function(e){return jQuery.map(e,function(e){return encodeURIComponent(e[0])+"="+encodeURIComponent(e[1])}).join("&")},e.prototype.appendToUrl=function(e,t){var r;return r=-1!==e.indexOf("?")?/[&\?]$/.exec(e)?"":"&":"?",e+r+t},e.prototype.buildUrlWithParams=function(e){var t,r,n;return n=new Array,jQuery.each(this.filterDeclarations,function(e){return function(t,r){var i;return i=e.readValuesAndFormQueryString(r.filterName,r.detached,r.templates,r.ids),i&&""!==i?n.push(i):void 0}}(this)),r=this.baseRequestForFilter,0!==n.length&&(t=n.join("&"),r=this.appendToUrl(r,t)),e&&(r=this.appendToUrl(r,this.parameterNameForFocus+e)),r},e.prototype.reset=function(){return window.location=this.baseRequestForFilter},e.prototype.exportToCsv=function(){return window.location=this.linkForExport},e.prototype.register=function(e){return this.filterDeclarations.push(e)},e.prototype.readValuesAndFormQueryString=function(e,t,r,n){var i,o,a,c,u,d,s,l,f,h;for(u=new Array,o=s=0,f=r.length-1;f>=0?f>=s:s>=f;o=f>=0?++s:--s){if(null===$(n[o]))return"development"===this.environment&&(c='WiceGrid: Error reading state of filter "'+e+'". No DOM element with id "'+n[o]+'" found.',t&&(c+='You have declared "'+e+'" as a detached filter but have not output it anywhere in the template. Read documentation about detached filters.'),alert(c)),"";if(i=$("#"+n[o]),i[0]&&"checkbox"===i[0].type?i[0].checked&&(d=1):d=i.val(),d instanceof Array)for(a=l=0,h=d.length-1;h>=0?h>=l:l>=h;a=h>=0?++l:--l)d[a]&&""!==d[a]&&u.push(r[o]+encodeURIComponent(d[a]));else d&&""!==d&&u.push(r[o]+encodeURIComponent(d))}return u.join("&")},e}(),e._version="3.2",window.WiceGridProcessor=e}).call(this),function(){var e,t,r,n,i,o,a,c,u,d,s,l,f,h,p;$(document).on("page:load ready",function(){return r()}),r=function(){return $(".wice-grid-container").each(function(t,r){var n,i,d,s,g,m,v,w,y;for(s=r.id,n=$(".wg-data",r),m=n.data("processor-initializer-arguments"),d=n.data("filter-declarations"),e(n.data("foc")),g=new WiceGridProcessor(s,m[0],m[1],m[2],m[3],m[4],m[5]),v=function(e){return g.register({filterName:e.filterName,detached:e.detached,templates:e.declaration.templates,ids:e.declaration.ids})},w=0,y=d.length;y>w;w++)i=d[w],v(i);return window[s]=g,u(),p(r,g),c(r,g),l(r),h(r,g),f(r),o(r,g),a(r)}),i(),s(),d(),f($(".wg-detached-filter"))},n=function(e,t,r,n,i){var o,a,c,u;return(o=t.data(e))&&(c=$(u="#"+o))&&(a=c.datepicker("getDate"))&&i(a,r)?(c.datepicker("setDate",r),c.next().next().html($.datepicker.formatDate(n,r))):void 0},u=function(){var e;return 0!==$(".wice-grid-container input.check-for-datepicker[type=hidden], .wg-detached-filter input.check-for-datepicker[type=hidden]").length&&($.datepicker||alert("Seems like you do not have jQuery datepicker (http://jqueryui.com/demos/datepicker/)\ninstalled. Either install it or set Wice::Defaults::HELPER_STYLE to :standard in\nwice_grid_config.rb in order to use standard Rails date helpers")),(e=$(".wice-grid-container input[type=hidden], .wg-detached-filter input[type=hidden]").data("locale"))&&$.datepicker.setDefaults($.datepicker.regional[e]),$(".wice-grid-container .date-label, .wg-detached-filter .date-label").each(function(e,t){var r,i,o,a,c;return i=$("#"+$(t).data("dom-id")),o=i.data("close-calendar-event-name"),$(t).click(function(e){return $(this).html(""),i.val(""),o&&i.trigger(o),e.preventDefault(),!1}),a=this,r=i.data("date-format"),c=i.data("date-year-range"),i.datepicker({firstDay:1,showOn:"button",dateFormat:r,buttonImage:i.data("button-image"),buttonImageOnly:!0,buttonText:i.data("button-text"),changeMonth:!0,changeYear:!0,yearRange:c,onSelect:function(e){var t;return t=$(this).datepicker("getDate"),n("the-other-datepicker-id-to",i,t,r,function(e,t){return t>e}),n("the-other-datepicker-id-from",i,t,r,function(e,t){return e>t}),$(a).html(e),o?i.trigger(o):void 0}})})},l=function(e){var t,r,n;return r=".wg-hide-filter",n=".wg-show-filter",t=".wg-filter-row",$(r,e).click(function(){return $(this).hide(),$(n,e).show(),$(t,e).hide()}),$(n,e).click(function(){return $(this).hide(),$(r,e).show(),$(t,e).show()})},c=function(e,t){return $(".export-to-csv-button",e).click(function(){return t.exportToCsv()})},p=function(e,t){return $(".submit",e).click(function(){return t.process()}),$(".reset",e).click(function(){return t.reset()}),$(".wg-filter-row input[type=text]",e).keydown(function(e){return 13===e.keyCode?(e.preventDefault(),t.process()):void 0})},e=function(e){var t,r;return r=$("#"+e),(t=r[0])?(t.value=t.value,t.focus()):void 0},o=function(e,t){return $("select.auto-reload",e).change(function(){return t.process()}),$("input.auto-reload",e).keyup(function(){return t.setProcessTimer(this.id)}),$("input.negation-checkbox.auto-reload",e).click(function(){return t.process()}),$(document).bind("wg:calendarChanged_"+t.name,function(){return t.process()})},i=function(){return $(".wg-detached-filter").each(function(e,r){var n;return n=t(r),n?($("select.auto-reload",r).change(function(){return n.process()}),$("input.auto-reload",r).keyup(function(){return n.setProcessTimer(this.id)}),$("input.negation-checkbox.auto-reload",r).click(function(){return n.process()})):void 0})},h=function(e,t){return $(".wg-show-all-link, .wg-back-to-pagination-link",e).click(function(e){var r,n,i;return e.preventDefault(),n=$(this).data("grid-state"),r=$(this).data("confim-message"),i=function(){return t.reloadPageForGivenGridState(n)},r?confirm(r)?i():void 0:i()})},f=function(e){return $(".expand-multi-select-icon",e).click(function(){return $(this).prev().each(function(e,t){return t.multiple=!0}),$(this).next().show(),$(this).hide()}),$(".collapse-multi-select-icon",e).click(function(){return $(this).prev().prev().each(function(e,t){return t.multiple=!1}),$(this).prev().show(),$(this).hide()})},a=function(e){return $(".select-all",e).click(function(){return $(".sel input",e).prop("checked",!0).trigger("change")}),$(".deselect-all",e).click(function(){return $(".sel input",e).prop("checked",!1).trigger("change")})},t=function(e){var t;return t=$(e).data("grid-name"),t?window[t]:null},d=function(){return $(".wg-external-csv-export-button").each(function(e,r){var n;return n=t(r),n?$(r).click(function(){return n.exportToCsv()}):void 0})},s=function(){return $(".wg-external-submit-button").each(function(e,r){var n;return n=t(r),n?$(r).click(function(e){return n.process(),e.preventDefault(),!1}):void 0}),$(".wg-external-reset-button").each(function(e,r){var n;return n=t(r),n?$(r).click(function(e){return n.reset(),e.preventDefault(),!1}):void 0}),$(".wg-detached-filter").each(function(e,r){var n;return n=t(r),n?$("input[type=text]",this).keydown(function(e){return 13===e.keyCode?(n.process(),e.preventDefault(),!1):void 0}):void 0})},window.getGridProcessorForElement=t}.call(this),function(){var e,t,r,n,i;$(document).on("page:load ready",function(){return i()}),i=function(){return $(".wice-grid-save-query-field").keydown(function(e){return 13===e.keyCode?n($(this).next(),e):void 0}),$(".wice-grid-save-query-button").click(function(e){return n(this,e)}),$(".wice-grid-delete-query").click(function(t){return e(this,t)}),$(".wice-grid-query-load-link").click(function(e){return t(this,e)})},t=function(e,t){var r,n,i;return(r=window.getGridProcessorForElement(e))&&(n=$(e).data("query-id"),i=r.appendToUrl(r.buildUrlWithParams(),r.parameterNameForQueryLoading+encodeURIComponent(n)),window.location=i),t.preventDefault(),t.stopPropagation(),!1},e=function(e,t){var n,i,o;return n=$(e).data("wg-confirm"),o=n?function(){return confirm(n)}:function(){return!0},o()&&(i=window.getGridProcessorForElement(e))&&jQuery.ajax({url:$(e).attr("href"),async:!0,dataType:"json",success:function(e){return r(e,i.name)},type:"POST"}),t.preventDefault(),t.stopPropagation(),!1},n=function(e,t){var n,i,o,a,c,u,d,s;return(i=window.getGridProcessorForElement(e))?(s=$(e),n=s.data("base-path-to-query-controller"),o=s.data("parameters"),c=s.data("ids"),a=s.prev(),c instanceof Array&&c.each(function(e){return o.push(["extra["+e+"]",$("#"+e).val()])}),u=a.val(),d=i.gridStateToRequest(o),jQuery.ajax({url:n,async:!0,data:d+"&query_name="+encodeURIComponent(u),dataType:"json",success:function(e){return r(e,i.name,u,a)},type:"POST"}),t.preventDefault(),!1):void 0},r=function(r,n,i,o){var a,c,u,d,s;return d="#"+n+"_notification_messages",c="#"+n+"_title",s="#"+n+"_query_list",i&&o.val(""),(a=r.error_messages)?$(d).text(a):((u=r.notification_messages)&&$(d).text(u),i&&$(c).html("<h3>"+i+"</h3>"),$(s).replaceWith(r.query_list),jQuery.ui&&$(s).effect("highlight"),$(".wice-grid-delete-query",$(s)).click(function(t){return e(this,t)}),$(".wice-grid-query-load-link",$(s)).click(function(e){return t(this,e)}))}}.call(this);